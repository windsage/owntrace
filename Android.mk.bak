# Fanstrace Application
LOCAL_PATH := $(call my-dir)

include $(CLEAR_VARS)

# Application basic config
LOCAL_PACKAGE_NAME := Fanstrace
LOCAL_MODULE_TAGS := optional
LOCAL_SYSTEM_EXT_MODULE := true
LOCAL_PRIVATE_PLATFORM_APIS := true
LOCAL_CERTIFICATE := platform
LOCAL_MODULE_PATH := $(PRODUCT_OUT)/system_ext/app
LOCAL_OPTIONAL_USES_LIBRARIES := androidx.window.extensions androidx.window.sidecar

# Source files
LOCAL_SRC_FILES := $(call all-java-files-under, src)

# Resource config
LOCAL_RESOURCE_DIR := $(LOCAL_PATH)/res
LOCAL_USE_AAPT2 := true


# Static libraries
LOCAL_STATIC_JAVA_LIBRARIES := \
    androidx.leanback_leanback \
    androidx.leanback_leanback-preference \
    androidx.appcompat_appcompat \
    androidx.preference_preference \
    androidx.recyclerview_recyclerview \
    SettingsLib

# Proguard config
LOCAL_PROGUARD_FLAG_FILES := proguard.flags

# Dependency config
LOCAL_REQUIRED_MODULES := \
    fanstrace.rc \
    start_fanstrace.sh \
    stop_fanstrace.sh \
    start_dfx_fanstrace.sh \
    stop_dfx_fanstrace.sh

# Build type
include $(BUILD_PACKAGE)

# Include library dependencies
include $(CLEAR_VARS)
include $(call all-makefiles-under,$(LOCAL_PATH))

# Init rc file
include $(CLEAR_VARS)
LOCAL_MODULE := fanstrace.rc
LOCAL_MODULE_CLASS := ETC
LOCAL_SRC_FILES := fanstrace.rc
LOCAL_MODULE_PATH := $(PRODUCT_OUT)/system_ext/etc/init
include $(BUILD_PREBUILT)

# Shell scripts
include $(CLEAR_VARS)
LOCAL_MODULE := start_fanstrace.sh
LOCAL_MODULE_CLASS := EXECUTABLES
LOCAL_SRC_FILES := start_fanstrace.sh
LOCAL_MODULE_PATH := $(PRODUCT_OUT)/system_ext/bin
LOCAL_SYSTEM_EXT_MODULE := true
include $(BUILD_PREBUILT)

include $(CLEAR_VARS)
LOCAL_MODULE := stop_fanstrace.sh
LOCAL_MODULE_CLASS := EXECUTABLES
LOCAL_SRC_FILES := stop_fanstrace.sh
LOCAL_MODULE_PATH := $(PRODUCT_OUT)/system_ext/bin
LOCAL_SYSTEM_EXT_MODULE := true
include $(BUILD_PREBUILT)

include $(CLEAR_VARS)
LOCAL_MODULE := start_dfx_fanstrace.sh
LOCAL_MODULE_CLASS := EXECUTABLES
LOCAL_SRC_FILES := start_dfx_fanstrace.sh
LOCAL_MODULE_PATH := $(PRODUCT_OUT)/system_ext/bin
LOCAL_SYSTEM_EXT_MODULE := true
include $(BUILD_PREBUILT)

include $(CLEAR_VARS)
LOCAL_MODULE := stop_dfx_fanstrace.sh
LOCAL_MODULE_CLASS := EXECUTABLES
LOCAL_SRC_FILES := stop_dfx_fanstrace.sh
LOCAL_MODULE_PATH := $(PRODUCT_OUT)/system_ext/bin
LOCAL_SYSTEM_EXT_MODULE := true
include $(BUILD_PREBUILT)
